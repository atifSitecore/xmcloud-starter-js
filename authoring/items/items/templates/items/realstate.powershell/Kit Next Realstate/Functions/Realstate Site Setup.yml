---
ID: "e0a3b4c5-d6f7-8901-2cde-f34567890123"
Parent: "d9f2a3b4-c5e6-7890-1bcd-ef2345678901"
Template: "dd22f1b3-bd87-4db2-9e7d-f7a496888d43"
Path: /sitecore/system/Modules/PowerShell/Script Library/Kit Next Realstate/Functions/Realstate Site Setup
SharedFields:
- ID: "b1a94ff0-6897-47c0-9c51-aa6acb80b1f0"
  Hint: Script
  Value: |
    Import-Function Get-ItemByIdSafe
    Import-Function Update-PageTemplate
    Import-Function Update-LinkField
    Import-Function Update-TemplateInsertOptions
    
    function Invoke-ModuleScriptBody {
        [CmdletBinding()]
        param(
            [Parameter(Mandatory = $true, Position = 0 )]
            [Item]$Site,
    
            [Parameter(Mandatory = $true, Position = 1 )]
            [Item[]]$TenantTemplates    
        )
    
        begin {
            Write-Log "Kit Next Realstate - Post Site Creation Script" -Log "INFO"
            Write-Verbose "Cmdlet Invoke-ModuleScriptBody - Begin"
            Import-Function Get-ProjectTemplateBasedOnBaseTemplate
        }
    
        process {
            Write-Verbose "Cmdlet Invoke-ModuleScriptBody - Process"
            $sitePath = $Site.Paths.Path
            $siteCollection = $Site.Parent
            $service = [Sitecore.DependencyInjection.ServiceLocator]::ServiceProvider.GetService([Sitecore.XA.Foundation.Variants.Abstractions.Services.IAvailableRenderingVariantService])
            $item = Get-Item -Path "$sitePath/Home" -Language $Site.Language
            Write-Verbose "My site: $sitePath"
    
            Write-Verbose "Reset the start item and the rendering host"
            $siteName = $Site.Name
            $siteGrouping = Get-Item -Path "$sitePath/Settings/Site Grouping/$($sitename)" -Language $Site.Language
            $siteGrouping.StartItem = $item.ID
    
            Write-Verbose "Create page templates in the Site Collection"
            $basePageTemplateId = "{AC9DE9BE-8E86-4147-8FBC-739D5560408B}"
            $baseHomePageTemplateId = "{4ACCF644-A506-421F-B60F-A05E5C6196B4}"
            $basePropertyDetailPageTemplateId = "{B0602368-F67C-433C-8700-862D480546D0}"
            $basePageFolderTemplateId = "{84DBE64B-0FED-4125-A971-725C0155C321}"
    
            $templatesRootPath = "master:/sitecore/templates/Project/$($siteCollection.Name)"
    
            $pageTemplate = Get-Item -Path "$templatesRootPath/Page" -ErrorAction SilentlyContinue
            if ($pageTemplate) {
                $pageTemplate."__Base template" = $basePageTemplateId
            }
    
            $homePageTemplate = Update-PageTemplate -BaseTemplateId $baseHomePageTemplateId -TemplateName "Home Page" -TemplatesRootPath $templatesRootPath
            $propertyDetailTemplate = Update-PageTemplate -BaseTemplateId $basePropertyDetailPageTemplateId -TemplateName "Property Detail Page" -TemplatesRootPath $templatesRootPath
            $pageFolderTemplate = Update-PageTemplate -BaseTemplateId $basePageFolderTemplateId -TemplateName "Page Folder" -TemplatesRootPath $templatesRootPath
    
            Write-Verbose "Update insert options"
            $insertOptions = @( $pageTemplate.ID, $propertyDetailTemplate.ID, $pageFolderTemplate.ID )
            Update-TemplateInsertOptions -TemplateItem $homePageTemplate -InsertOptions $insertOptions
            Update-TemplateInsertOptions -TemplateItem $pageTemplate -InsertOptions $insertOptions
            Update-TemplateInsertOptions -TemplateItem $propertyDetailTemplate -InsertOptions $insertOptions
            Update-TemplateInsertOptions -TemplateItem $pageFolderTemplate -InsertOptions $insertOptions
    
            # Add Page Design and link partial designs
            Write-Verbose "Add Page Design and link partial designs"
            $headerPartial = Get-Item -Path "$sitePath/Presentation/Partial Designs/Global/Header" -Language $Site.Language -ErrorAction SilentlyContinue
            $footerPartial = Get-Item -Path "$sitePath/Presentation/Partial Designs/Global/Footer" -Language $Site.Language -ErrorAction SilentlyContinue
    
            if ($headerPartial -and $footerPartial) {
                $defaultPageDesign = New-Item -Path "$($sitePath)/Presentation/Page Designs" -Name "Default" -ItemType "{1105B8F8-1E00-426B-BF1F-C840742D827B}"
                $defaultPageDesign.PartialDesigns = "$($headerPartial.ID)|$($footerPartial.ID)"
    
                $pageDesigns = Get-Item -path "$sitePath/Presentation/Page Designs" -Language $Site.Language
                $map = [Sitecore.Text.UrlString]::new()
                $map[$homePageTemplate.ID] = "$($defaultPageDesign.ID)"
                $map[$pageTemplate.ID] = "$($defaultPageDesign.ID)"
                $map[$propertyDetailTemplate.ID] = "$($defaultPageDesign.ID)"
                $map[$pageFolderTemplate.ID] = "$($defaultPageDesign.ID)"
                $pageDesigns.TemplatesMapping = [System.Web.HttpUtility]::UrlEncode($map.toString())
            }
    
            Write-Verbose "Update the home page template"
            Set-ItemTemplate -Item $item -Template $homePageTemplate.ID
            $item = Get-Item -Path "$sitePath/Home" -Language $Site.Language
    
            # Set templates for child pages
            Set-ItemTemplate -Path "$sitePath/Home/Properties" -Template $pageFolderTemplate.ID
            Set-ItemTemplate -Path "$sitePath/Home/About" -Template $pageTemplate.ID
            Set-ItemTemplate -Path "$sitePath/Home/Contact" -Template $pageTemplate.ID
            Set-ItemTemplate -Path "$sitePath/Home/Communities" -Template $pageTemplate.ID
            Set-ItemTemplate -Path "$sitePath/Home/News" -Template $pageTemplate.ID
    
            # Set property detail pages
            Get-ChildItem -Path "$sitePath/Home/Properties" | ForEach-Object {
                if ($_.TemplateName -ne "Data Folder") {
                    Set-ItemTemplate -Item $_ -Template $propertyDetailTemplate.ID
                }
            }
    
            Write-Verbose "Update the home page renderings"
            $renderingContainerFullBleed = Get-Item -Path '/sitecore/layout/Renderings/Feature/JSS Experience Accelerator/Page Structure/Container Full Bleed' -ErrorAction SilentlyContinue
            $renderingPropertyHero = Get-Item -Path '/sitecore/layout/Renderings/Project/kit-next-realstate/Property/PropertyHero' -ErrorAction SilentlyContinue
            $renderingPropertyGrid = Get-Item -Path '/sitecore/layout/Renderings/Project/kit-next-realstate/Property/PropertyGrid' -ErrorAction SilentlyContinue
            $renderingCommunityShowcase = Get-Item -Path '/sitecore/layout/Renderings/Project/kit-next-realstate/Community/CommunityShowcase' -ErrorAction SilentlyContinue
    
            # prepare rendering definitions
            if ($renderingContainerFullBleed) {
                $renderingContainerFullBleedDefinition = $renderingContainerFullBleed | New-Rendering
            }
            if ($renderingPropertyHero) {
                $renderingPropertyHeroDefinition = $renderingPropertyHero | New-Rendering
            }
            if ($renderingPropertyGrid) {
                $renderingPropertyGridDefinition = $renderingPropertyGrid | New-Rendering
            }
            if ($renderingCommunityShowcase) {
                $renderingCommunityShowcaseDefinition = $renderingCommunityShowcase | New-Rendering
            }
    
            # prepare rendering variants using service like Solterra
            if ($renderingPropertyHero -and $service) {
                $propertyHeroVariants = $service.GetAvailableRenderingVariants($Site, $renderingPropertyHero.Name, $renderingPropertyHero.ID, $item.TemplateID)
                $propertyHeroVariant = $propertyHeroVariants | Where-Object { $_.DisplayName -eq "Default" }
            }
    
            # Add renderings to Home page using local:/Data/... pattern
            if ($renderingContainerFullBleedDefinition) {
                Add-Rendering -Item $item -PlaceHolder "headless-main" -Instance $renderingContainerFullBleedDefinition -Parameter @{ "DynamicPlaceholderId" = "1"; "excludeTopMargin" = "1" } -FinalLayout
            }
            if ($renderingPropertyHeroDefinition -and $propertyHeroVariant) {
                Add-Rendering -Item $item -PlaceHolder "/headless-main/container-fullbleed-1" -Instance $renderingPropertyHeroDefinition -Parameter @{ "FieldNames" = $propertyHeroVariant.ID; "DynamicPlaceholderId" = "2" } -DataSource "local:/Data/Home Hero" -FinalLayout
            } elseif ($renderingPropertyHeroDefinition) {
                Add-Rendering -Item $item -PlaceHolder "/headless-main/container-fullbleed-1" -Instance $renderingPropertyHeroDefinition -Parameter @{ "DynamicPlaceholderId" = "2" } -DataSource "local:/Data/Home Hero" -FinalLayout
            }
            if ($renderingPropertyGridDefinition) {
                Add-Rendering -Item $item -PlaceHolder "/headless-main/container-fullbleed-1" -Instance $renderingPropertyGridDefinition -Parameter @{ "DynamicPlaceholderId" = "3" } -DataSource "local:/Data/Featured Properties" -FinalLayout
            }
            if ($renderingCommunityShowcaseDefinition) {
                Add-Rendering -Item $item -PlaceHolder "/headless-main/container-fullbleed-1" -Instance $renderingCommunityShowcaseDefinition -Parameter @{ "DynamicPlaceholderId" = "4" } -DataSource "local:/Data/Community Highlights" -FinalLayout
            }
    
            # Note: Base SXA templates use "Title" and "NavigationTitle" fields
            # Field values are already set in branch items, so we skip field updates here
            # to avoid conflicts with non-existent fields on base templates
    
            Write-Log "Real Estate site setup completed successfully" -Log "INFO"
        }
    
        end {
            Write-Verbose "Cmdlet Invoke-ModuleScriptBody - End"
        }
    }
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20251206T000000Z
